{% extends "taxlover/base.html" %}
{% load crispy_forms_tags %}
{% load humanize %}
{% block content %}
    <div class="salary-main">
        <form method="post">
            {% csrf_token %}
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col" class="col-6"></th>
                        <th scope="col">Yearly Income</th>
                        <th scope="col">Exempted Income</th>
                        <th scope="col">Taxable Income</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">
                            <label for="{{ form.basic.id_for_label }}"
                                   class="col-form-label required">Basic Salary</label>
                        </th>
                        <td>
                            {{ form.basic }}
                        </td>
                        <td>
                            <input id="id_basic_exempted" class="form-control" type="text" placeholder=""
                                   aria-label="Disabled input example" disabled>
                        </td>
                        <td>
                            <input id="id_basic_taxable" class="form-control" type="text" placeholder=""
                                   aria-label="Disabled input example" disabled>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">
                            <label for="{{ form.basic.id_for_label }}"
                                   class="col-form-label">House Rent Allowance</label>
                        </th>
                        <td>
                            {{ form.house_rent }}
                        </td>
                        <td>
                            <input class="form-control" type="text" placeholder=""
                                   aria-label="Disabled input example" disabled>
                        </td>
                        <td>
                            <input class="form-control" type="text" placeholder=""
                                   aria-label="Disabled input example" disabled>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">
                            <label for="{{ form.basic.id_for_label }}"
                                   class="col-form-label">Medical Allowance</label>
                        </th>
                        <td>
                            {{ form.medical }}
                        </td>
                        <td>
                            <input class="form-control" type="text" placeholder=""
                                   aria-label="Disabled input example" disabled>
                        </td>
                        <td>
                            <input class="form-control" type="text" placeholder=""
                                   aria-label="Disabled input example" disabled>
                        </td>
                    </tr>
                </tbody>
                <tfoot>
                    <th scope="col" class="col-6">Total</th>
                        <th scope="col" style="padding-left: 20px" id="total_income"></th>
                        <th scope="col"></th>
                        <th scope="col"></th>
                </tfoot>
            </table>
            <div style="text-align: center;padding-top: 20px">
                <button type="submit" class="btn btn-primary">Save Salary Income</button>
            </div>
        </form>
    </div>
    <script type="application/javascript">
        $(function () {
            setExemptedColumn();
            setTotalRow();
        });

        function setTotalRow() {
            let basic = parseDecimalInputValue('id_basic');
            let houseRent = parseDecimalInputValue('id_house_rent');
            let medical = parseDecimalInputValue('id_medical');

            let total = basic + houseRent + medical;

            document.getElementById('total_income').innerHTML = addCommas(formatToTwoDecimalPlaces(total.toString()));
        }

        function setExemptedColumn() {
            if (hasInputValue('id_basic')) {
                document.getElementById('id_basic_exempted').value = "0";
            } else {
                document.getElementById('id_basic_exempted').value = "";
            }
        }

        function inputBlur(textBoxObject) {
            textBoxObject.value = removeCommas(textBoxObject.value);
            textBoxObject.value = addCommas(formatToTwoDecimalPlaces(textBoxObject.value));
            setExemptedColumn();
            setTotalRow();
        }
    </script>
{% endblock content %}